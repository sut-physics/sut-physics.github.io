<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - การวิจัยขั้นแนวหน้าด้านฟิสิกส์</title>

    <!-- External Libraries (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/tables.css">
    <link rel="stylesheet" href="css/budget.css">
    <link rel="stylesheet" href="css/sidebar.css">
    <link rel="stylesheet" href="css/comparison.css">
    <link rel="stylesheet" href="css/accordion.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h2>Dashboard Login</h2>
            <p>กรุณาใส่รหัสผ่านเพื่อเข้าใช้งาน</p>
            <input type="password" id="passwordInput" placeholder="รหัสผ่าน" onkeypress="if(event.key==='Enter')attemptLogin()">
            <button onclick="attemptLogin()">เข้าสู่ระบบ</button>
            <div id="loginError" class="login-error">รหัสผ่านไม่ถูกต้อง</div>
        </div>
    </div>

    <!-- Main App Content -->
    <div id="appContent" class="app-content">
    <header class="header" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 id="projectTitle">การวิจัยขั้นแนวหน้าด้านฟิสิกส์อนุภาคมูลฐานและฟิสิกส์ดาราศาสตร์</h1>
            <div class="subtitle" id="projectLeader">หัวหน้าโครงการ: รศ.ดร.อายุทธ ลิ้มพิรัตน์</div>
        </div>
        <button onclick="logout()" style="padding: 8px 16px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4); color: white; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">ออกจากระบบ</button>
    </header>

    <nav class="nav-tabs">
        <button class="nav-tab active" data-page="dashboard">Dashboard</button>
        <button class="nav-tab" data-page="budget">รายละเอียดงบประมาณ</button>
        <button class="nav-tab" data-page="comparison">เปรียบเทียบ Sheet</button>
    </nav>

    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-title">ชื่อ Sheet</div>
            <ul class="sheet-list" id="sheetList">
                <!-- Dynamic sheet list -->
            </ul>
            <div class="upload-section">
                <a href="https://docs.google.com/spreadsheets/d/1D1Upkcj7fB760vdaO0py-JjiAWPi3ASt73H7gvDKrZI/edit?usp=sharing" target="_blank" class="upload-btn" style="text-decoration: none; text-align: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    แก้ไข Sheet
                </a>
            </div>
        </aside>

        <main class="content">
            <!-- Dashboard Page -->
            <div id="dashboardPage">
                <!-- Project Info -->
                <div class="card">
                    <div class="card-header">
                        <span>ข้อมูลโครงการ</span>
                        <div class="edit-btn-container" id="editInfoBtnContainer">
                            <button class="edit-toggle-btn" onclick="toggleEditMode('info')">แก้ไข</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-grid" id="projectInfo">
                            <!-- Dynamic project info -->
                        </div>
                    </div>
                </div>

                <!-- Output Summary -->
                <div class="summary-cards" id="summaryCards">
                    <!-- Dynamic summary cards -->
                </div>

                <!-- Output Table -->
                <div class="card">
                    <div class="card-header">
                        <span>ผลผลิตที่คาดว่าจะได้รับ (Output)</span>
                        <div class="edit-btn-container" id="editOutputBtnContainer">
                            <button class="edit-toggle-btn" onclick="toggleEditMode('output')">แก้ไข</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="outputTabs" class="output-tabs"></div>
                        <table class="output-table">
                            <thead>
                                <tr>
                                    <th style="width: 30%">รายการ</th>
                                    <th style="width: 10%">เป้าหมาย</th>
                                    <th style="width: 10%">แล้วเสร็จ</th>
                                    <th style="width: 20%">ความคืบหน้า</th>
                                    <th style="width: 30%">รายชื่อ</th>
                                </tr>
                            </thead>
                            <tbody id="outputTable">
                                <!-- Dynamic output data -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Budget Details Page -->
            <div id="budgetPage" class="hidden">
                <h2 style="margin-bottom: 20px; color: var(--primary);">รายละเอียดงบประมาณ</h2>

                <!-- Budget Summary Cards -->
                <div class="budget-summary-cards" id="budgetSummaryCards"></div>

                <!-- Budget Detail Card -->
                <div class="card">
                    <div class="card-header">
                        <span>รายละเอียดงบประมาณ</span>
                        <div class="edit-btn-container" id="editBudgetBtnContainer">
                            <div class="budget-btn-group">
                                <button class="edit-toggle-btn" onclick="toggleBudgetEditMode()">แก้ไข</button>
                                <button class="edit-toggle-btn" onclick="showAddBudgetItemModal()">+ เพิ่มรายการ</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" style="padding: 20px;">
                        <!-- Budget type tabs -->
                        <div class="budget-type-tabs" id="budgetTypeTabs"></div>
                        <!-- Subcategory tabs -->
                        <div class="budget-subcat-tabs" id="budgetSubcatTabs"></div>
                        <!-- Budget table -->
                        <table class="budget-table">
                            <thead>
                                <tr>
                                    <th style="width: 40%">รายการ</th>
                                    <th class="number" style="width: 20%">งบประมาณ (บาท)</th>
                                    <th class="number" style="width: 20%">ใช้จ่าย (บาท)</th>
                                    <th class="number" style="width: 20%">คงเหลือ (บาท)</th>
                                </tr>
                            </thead>
                            <tbody id="budgetTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Comparison Page -->
            <div id="comparisonPage" class="hidden">
                <h2 style="margin-bottom: 20px; color: var(--primary);">เปรียบเทียบผลผลิตระหว่าง Sheet</h2>

                <!-- Sheet Selector -->
                <div class="comparison-selector">
                    <h3>เลือก Sheet ที่ต้องการเปรียบเทียบ</h3>
                    <div class="help-text">เลือกได้สูงสุด 4 Sheet (คลิกเพื่อเลือก/ยกเลิก)</div>
                    <div class="sheet-checkboxes" id="sheetCheckboxes">
                        <!-- Dynamic checkboxes -->
                    </div>
                </div>

                <!-- Comparison Chart -->
                <div class="chart-container" style="margin-bottom: 20px;">
                    <h3>เปรียบเทียบ % ความคืบหน้า (แต่ละ Sheet)</h3>
                    <canvas id="comparisonChart"></canvas>
                </div>

                <!-- 9 Categories Accordion -->
                <div class="accordion-container" id="accordionContainer">
                    <!-- Dynamic accordion items -->
                </div>
            </div>
        </main>
    </div>
    </div><!-- End appContent -->

    <!-- JavaScript: Layer 1 - Data & Configuration -->
    <script src="js/config.js"></script>
    <script src="js/default-data.js"></script>
    <script src="js/state.js"></script>

    <!-- JavaScript: Layer 2 - Utilities -->
    <script src="js/utils.js"></script>

    <!-- JavaScript: Layer 3 - Feature modules -->
    <script src="js/accordion.js"></script>
    <script src="js/sheets-sync.js"></script>
    <script src="js/budget.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/comparison.js"></script>
    <script src="js/file-upload.js"></script>
    <script src="js/firebase-sync.js"></script>
    <script src="js/auth.js"></script>

    <!-- JavaScript: Layer 4 - Bootstrap -->
    <script src="js/app.js"></script>
</body>
</html>
